
import { useParams, useNavigate } from "react-router-dom";
import { useEffect, useState } from "react";
import Header from "@/components/Header";
import Footer from "@/components/Footer";
import VeteranProfile from "@/components/VeteranProfile";
import { ChevronLeft, Share2 } from "lucide-react";

// Моковые данные о ветеранах для примера
const veteransData = [
  {
    id: 1,
    name: "Иванов Иван Петрович",
    birthYear: "1919",
    deathYear: "2001",
    rank: "Старший лейтенант",
    service: "Пехота",
    photo: "https://i.ibb.co/s9TTCH1/veteran1.jpg",
    story: `Родился 15 августа 1919 года в селе Петровка. В июне 1941 года, сразу после объявления войны, добровольцем ушел на фронт.\n\nПрошел всю войну от Москвы до Берлина. Участвовал в обороне Москвы в составе 316-й стрелковой дивизии. В ноябре 1941 года получил первое ранение, после госпиталя вернулся в строй.\n\nВоевал на Курской дуге, участвовал в освобождении Украины, Польши. За проявленную храбрость в боях за освобождение города Ковель был награжден орденом Красной Звезды. В апреле 1945 года участвовал в штурме Берлина.\n\nПосле войны работал учителем истории в средней школе, воспитал троих детей.`,
    battles: ["Оборона Москвы", "Курская битва", "Освобождение Польши", "Штурм Берлина"],
    awards: ["Орден Красной Звезды", "Медаль «За отвагу»", "Медаль «За взятие Берлина»"],
    location: "Московская область"
  },
  {
    id: 2,
    name: "Петров Михаил Сергеевич",
    birthYear: "1922",
    deathYear: "1995",
    rank: "Капитан",
    service: "Артиллерия",
    photo: "https://i.ibb.co/YP8Y9KL/veteran2.jpg",
    story: `Родился 10 октября 1922 года в Ленинграде. Призван на фронт в июле 1941 года, сразу после окончания артиллерийского училища.\n\nВ 1942 году в составе 76-й стрелковой дивизии участвовал в боях под Сталинградом. Командовал артиллерийской батареей, которая уничтожила несколько вражеских танков и огневых точек.\n\nВ 1943 году за мужество, проявленное в битве на Курской дуге, был награжден орденом Отечественной войны II степени. В 1944 году участвовал в освобождении Белоруссии в рамках операции "Багратион".\n\nПосле войны работал инженером на оборонном предприятии, активно участвовал в патриотическом воспитании молодежи.`,
    battles: ["Сталинградская битва", "Курская дуга", "Операция «Багратион»"],
    awards: ["Орден Отечественной войны II степени", "Орден Красной Звезды", "Медаль «За оборону Сталинграда»"],
    location: "Санкт-Петербург"
  },
  {
    id: 3,
    name: "Сидорова Анна Ивановна",
    birthYear: "1924",
    deathYear: "2010",
    rank: "Старшина медицинской службы",
    service: "Медицинская служба",
    photo: "https://i.ibb.co/JR9SgyG/veteran3.jpg",
    story: `Родилась 5 мая 1924 года в небольшом городке под Смоленском. В 1942 году, после окончания курсов медсестер, добровольно ушла на фронт.\n\nСлужила в полевом госпитале 2-го Белорусского фронта. За время войны оказала первую помощь более чем 500 раненым бойцам, многим из них спасла жизнь, вынося с поля боя под огнем противника.\n\nВ 1944 году за проявленное мужество при спасении раненых во время бомбардировки госпиталя была награждена медалью «За боевые заслуги».\n\nПосле войны работала медсестрой в городской больнице, затем старшей медсестрой. Воспитала двух дочерей, которые также посвятили жизнь медицине.`,
    battles: ["Освобождение Беларуси", "Восточно-Прусская операция"],
    awards: ["Медаль «За боевые заслуги»", "Медаль «За победу над Германией»"],
    location: "Смоленск"
  },
  {
    id: 4,
    name: "Кузнецов Алексей Дмитриевич",
    birthYear: "1920",
    deathYear: "1943",
    rank: "Гвардии майор",
    service: "Танковые войска",
    photo: "https://i.ibb.co/dM6G8Lz/veteran4.jpg",
    story: `Родился 22 июня 1920 года в Тульской области. В 1939 году окончил танковое училище, служил командиром танкового взвода.\n\nС первых дней войны на фронте. В июле 1941 года в составе 1-й танковой дивизии участвовал в оборонительных боях под Минском и Смоленском. В октябре 1941 года отличился в боях на подступах к Москве, когда его экипаж уничтожил 3 вражеских танка и несколько пулеметных точек.\n\nВ 1942 году за проявленное мужество в боях был награжден орденом Красного Знамени и получил звание майора. Командовал танковой ротой.\n\nГеройски погиб в бою 12 июля 1943 года во время Курской битвы. Его танк подбил два «Тигра», но сам был подожжен. Экипаж погиб, не покинув горящую машину, ведя огонь до последнего.`,
    battles: ["Оборона Минска", "Оборона Москвы", "Курская битва"],
    awards: ["Орден Красного Знамени", "Медаль «За отвагу»"],
    location: "Тульская область"
  },
  {
    id: 5,
    name: "Смирнов Николай Иванович",
    birthYear: "1918",
    deathYear: "1985",
    rank: "Рядовой",
    service: "Пехота",
    photo: "https://i.ibb.co/CWqyM8J/veteran5.jpg",
    story: `Родился 7 ноября 1918 года в крестьянской семье. Призван в армию в 1939 году. Великую Отечественную войну встретил на западной границе.\n\nВ первые месяцы войны попал в окружение, но сумел выйти к своим. Воевал под Смоленском, участвовал в обороне Москвы. В декабре 1941 года был ранен, после госпиталя вернулся в строй.\n\nУчаствовал в Сталинградской битве, освобождении Украины. В боях проявлял исключительное мужество, несмотря на то, что был рядовым солдатом.\n\nПосле войны работал на заводе, был активным участником ветеранского движения.`,
    battles: ["Оборона Москвы", "Сталинградская битва", "Освобождение Украины"],
    awards: ["Медаль «За отвагу»", "Медаль «За оборону Москвы»", "Медаль «За оборону Сталинграда»"],
    location: "Рязанская область"
  },
  {
    id: 6,
    name: "Козлова Мария Петровна",
    birthYear: "1923",
    deathYear: "2005",
    rank: "Сержант",
    service: "Связь",
    photo: "https://i.ibb.co/JBysz3r/veteran6.jpg",
    story: `Родилась 15 марта 1923 года в Москве. В начале войны работала на радиоузле, затем в 1942 году добровольно ушла на фронт.\n\nСлужила связисткой в составе 16-й воздушной армии. Обеспечивала бесперебойную связь между штабом и боевыми частями, часто под вражескими бомбежками и артобстрелами.\n\nЗа обеспечение связи во время решающих боев за Москву награждена медалью «За оборону Москвы». Дошла до Берлина.\n\nПосле войны окончила институт связи, работала инженером на телефонной станции. Была активна в общественной жизни, часто выступала перед школьниками с рассказами о войне.`,
    battles: ["Оборона Москвы", "Битва за Днепр", "Берлинская операция"],
    awards: ["Медаль «За оборону Москвы»", "Медаль «За взятие Берлина»", "Орден Отечественной войны II степени"],
    location: "Москва"
  },
  {
    id: 7,
    name: "Морозов Павел Сергеевич",
    birthYear: "1925",
    deathYear: "1970",
    rank: "Младший лейтенант",
    service: "Авиация",
    photo: "https://i.ibb.co/Y8Ls9Hr/veteran7.jpg",
    story: `Родился 3 декабря 1925 года. В 1943 году, после окончания лётной школы, был направлен на фронт.\n\nСлужил стрелком-радистом на бомбардировщике Пе-2. Совершил 87 боевых вылетов. В воздушных боях экипаж, в котором он служил, сбил 3 вражеских истребителя.\n\nВ октябре 1944 года был сбит над территорией противника, но сумел выжить и вернуться в свою часть. За проявленные мужество и героизм награжден орденом Красной Звезды.\n\nПосле войны работал в гражданской авиации, был пилотом пассажирского самолета.`,
    battles: ["Белорусская операция", "Восточно-Прусская операция", "Берлинская операция"],
    awards: ["Орден Красной Звезды", "Медаль «За взятие Кенигсберга»", "Медаль «За взятие Берлина»"],
    location: "Нижний Новгород"
  },
  {
    id: 8,
    name: "Соколов Дмитрий Алексеевич",
    birthYear: "1917",
    deathYear: "1944",
    rank: "Капитан",
    service: "Артиллерия",
    photo: "https://i.ibb.co/7nTDbtZ/veteran8.jpg",
    story: `Родился 1 января 1917 года в семье учителя. Окончил артиллерийское училище в 1939 году, служил командиром артиллерийской батареи.\n\nС начала войны на фронте. Отличился в боях под Ельней в августе 1941 года, когда его батарея уничтожила 5 танков и отразила атаку противника.\n\nВ 1943 году участвовал в форсировании Днепра. За проявленные героизм и умелое руководство батареей был награжден орденом Отечественной войны I степени.\n\nПогиб 23 июня 1944 года в ходе операции "Багратион" при освобождении Белоруссии. Посмертно награжден орденом Отечественной войны I степени.`,
    battles: ["Ельнинская операция", "Форсирование Днепра", "Операция «Багратион»"],
    awards: ["Орден Отечественной войны I степени (дважды)", "Медаль «За отвагу»"],
    location: "Смоленская область"
  }
];

const VeteranPage = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const [veteran, setVeteran] = useState<any | null>(null);

  useEffect(() => {
    // Имитация загрузки данных с сервера
    const veteranId = parseInt(id || "0", 10);
    const foundVeteran = veteransData.find(v => v.id === veteranId);
    
    if (foundVeteran) {
      setVeteran(foundVeteran);
    } else {
      // Ветеран не найден, перенаправляем на страницу поиска
      navigate("/search");
    }
  }, [id, navigate]);

  const handleShare = () => {
    if (navigator.share) {
      navigator.share({
        title: veteran ? `История ветерана: ${veteran.name}` : "История ветерана",
        text: "Ознакомьтесь с историей ветерана Великой Отечественной войны",
        url: window.location.href
      });
    }
  };

  if (!veteran) {
    return (
      <div className="flex flex-col min-h-screen">
        <Header />
        <main className="flex-grow bg-gray-50 py-12">
          <div className="container mx-auto px-4 text-center">
            <p className="text-lg">Загрузка данных...</p>
          </div>
        </main>
        <Footer />
      </div>
    );
  }

  return (
    <div className="flex flex-col min-h-screen">
      <Header />
      <main className="flex-grow bg-gray-50 py-12">
        <div className="container mx-auto px-4">
          <div className="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center">
            <button 
              onClick={() => navigate(-1)} 
              className="flex items-center text-victory-dark-red hover:text-victory-gold transition-colors mb-4 sm:mb-0"
            >
              <ChevronLeft className="w-5 h-5 mr-1" />
              <span>Вернуться назад</span>
            </button>
            
            <button 
              onClick={handleShare}
              className="flex items-center text-victory-dark-red hover:text-victory-gold transition-colors"
            >
              <Share2 className="w-5 h-5 mr-1" />
              <span>Поделиться историей</span>
            </button>
          </div>
          
          <VeteranProfile {...veteran} />
          
          {/* Похожие истории */}
          <div className="mt-12">
            <h2 className="text-2xl font-bold mb-6 text-victory-dark-blue">Похожие истории</h2>
            
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
              {veteransData
                .filter(v => v.id !== veteran.id && v.service === veteran.service)
                .slice(0, 4)
                .map((relatedVeteran) => (
                  <VeteranCard 
                    key={relatedVeteran.id}
                    id={relatedVeteran.id}
                    name={relatedVeteran.name}
                    years={`${relatedVeteran.birthYear} — ${relatedVeteran.deathYear}`}
                    rank={relatedVeteran.rank}
                    service={relatedVeteran.service}
                    photo={relatedVeteran.photo}
                    awards={relatedVeteran.awards}
                  />
                ))}
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  );
};

export default VeteranPage;
